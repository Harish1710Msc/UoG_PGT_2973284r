<html>

<head>
	
	<link rel="stylesheet" href="style.css">
    <style>
        #root {
            width: 100vw;
            height: 100vh;
            }
    </style>
	<script src = "https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>


<body>
	
	<div>
		<button id="socketTest">Play Whistle sound</button>
		
	</div>
	<div>
		<button id="birdTest">Play Bird Sound</button>
	
	</div>
	<script src="./videocall.js"></script>
	
	<audio id="whistle" src="whistle1.mp3"></audio>
				<button onclick="playWhistle()"> Play Whistle Sound</button>
				
				<script>
					function playWhistle(){
						const audio = document.getElementById("whistle");
						audio.currentTime=0;
						audio.play();
					}
				</script>
			
			<audio id="birdSound" src="bird.mp3"></audio>
						<button onclick="playBirdSound()">Play a Bird Sound</button>
						
						<script>
							function playBirdSound(){
								const audio = document.getElementById("birdSound");
								audio.currentTime=0;
								audio.play();
							}
						</script>
		<button class=' button-sound' id="recordASound"> Record your own sound </button>
			<div id="controls" style="display: none;">
				<button class='Record' id="Record">Record</button>
				<button class='Pause' id="Pause">Pause</button>
				<button class='Play' id="Play">Play</button>
			</div>
			<script>
				let mediaRecorder;
				let audioChunks = [];
				let audioBlob;
				let audioUrl;
				let audio;
				 
				navigator.mediaDevices.getUserMedia({ audio: true })
				  .then(stream => {
				    mediaRecorder = new MediaRecorder(stream);
				 
				    mediaRecorder.ondataavailable = event => {
				      audioChunks.push(event.data);
				    };
				 
				    mediaRecorder.onstop = () => {
				      audioBlob = new Blob(audioChunks, { type: 'audio/mp3' });
				      audioUrl = URL.createObjectURL(audioBlob);
				      audio = new Audio(audioUrl);
				    };
				 
				    document.getElementById('Record').onclick = () => {
				      audioChunks = [];
				      mediaRecorder.start();
				    };
				 
				    document.getElementById('Pause').onclick = () => {
				      mediaRecorder.stop();
				    };
				 
				    document.getElementById('Play').onclick = () => {
				      if (audio) audio.play();
				    };
				  });
				  
				document.getElementById('recordASound').addEventListener('click', () =>{
					document.getElementById('controls').style.display='block';
				})
			</script>
		
		
			
		
			
		
		
		
			<button style="float: right;"
			class='button-primary' id="petLogout" onclick="petLogout()"> Dog Logout</button>
			<script>
				function petLogout(){
					const dogName = localStorage.getItem("dogName");
					
			fetch('https://dogvideocall-latest.onrender.com/api/v1/users/logout/dog',{
					//fetch('http://localhost:8085/api/v1/users/logout/dog',{
								method: 'POST',
								headers: {
									'Content-Type' : 'application/json'
								},
								body: JSON.stringify(dogName)
							}).then(response => {
								
								if(!response.ok){
									alert('Error in Logging out');
									throw new Error('Logging out failed');
									
								}
								window.close();
								return response.json();
							}).catch(error => {
								console.error('POST request error',error)
							});
						
					
					
					
				}
			</script>
		
	</div>
	
    <div id="root"></div>
</body>
<script src="https://unpkg.com/@zegocloud/zego-uikit-prebuilt/zego-uikit-prebuilt.js"></script>
<script>
window.onload = function () {
    function getUrlParams(url) {
        let urlStr = url.split('?')[1];
        const urlSearchParams = new URLSearchParams(urlStr);
        const result = Object.fromEntries(urlSearchParams.entries());
        return result;
    }


        // Generate a Token by calling a method.
        // @param 1: appID
        // @param 2: serverSecret
        // @param 3: Room ID
        // @param 4: User ID
        // @param 5: Username
		
	const userName = localStorage.getItem('ownerName');
	let roomID = '';
	//let userID = '';
	
	if(userName=='Participant1'){
		roomID= "1234";
		//userID=  "12340";
	}
	else if(userName=='Participant2'){
		roomID= "2345";
		//userID= "23450";
	}
	else{
		roomID= "3456";
		//userID= "34560";
	}

    //const roomID = getUrlParams(window.location.href)['roomID'] || (Math.floor(Math.random() * 10000) + "");
	
   const userID = Math.floor(Math.random() * 10000) + "";
	localStorage.setItem('roomId',roomID);
	
    //const userName =getUrlParams(window.location.href)['ownerName'] || "userName" + userID;
    const appID = 2013589740;
    const serverSecret = "6bf86b3fc94765d6215df82152d4951c";
    const kitToken = ZegoUIKitPrebuilt.generateKitTokenForTest(appID, serverSecret, roomID, userID, userName);
	
	console.log(roomID);
	console.log(userID);
	console.log(userName);
	console.log(kitToken);
	
    
        const zp = ZegoUIKitPrebuilt.create(kitToken);
        zp.joinRoom({
            container: document.querySelector("#root"),
            sharedLinks: [{
                name: 'Personal link',
                url: window.location.protocol + '//' + window.location.host  + window.location.pathname + '?roomID=' + roomID,
            }],
            scenario: {
                mode: ZegoUIKitPrebuilt.VideoConference,
            },
                
           	turnOnMicrophoneWhenJoining: true,
           	turnOnCameraWhenJoining: true,
           	showMyCameraToggleButton: true,
           	showMyMicrophoneToggleButton: true,
           	showAudioVideoSettingsButton: true,
           	showScreenSharingButton: true,
           	showTextChat: true,
           	showUserList: true,
           	maxUsers: 2,
           	layout: "Auto",
           	showLayoutButton: false,
         
            });
}
</script>

</html>